{% extends 'base.html' %}

{% block title %}Mes Amis{% endblock %}

{% block content %}
<div class="container mt-4">
  <h2>Mes Amis</h2>

  <!-- Rechercher des utilisateurs -->
  <!-- Rechercher des utilisateurs -->
  <div class="card mb-4">
    <div class="card-header bg-primary text-white">
      <h5>Rechercher des utilisateurs</h5>
    </div>
    <div class="card-body">
      <form method="GET" action="{{ url_for('friends') }}">
        <div class="input-group">
          <input type="text" class="form-control" name="search" placeholder="Username de l'utilisateur" value="{{ request.args.get('search', '') }}">
          <button class="btn btn-primary" type="submit">Rechercher</button>
        </div>
      </form>
      {% if request.args.get('search') %}
      {% set search_email = request.args.get('search') %}
      {% if users %}
      <div class="mt-3">
        <h6>Résultats :</h6>
        {% for user in users %}
        <div class="d-flex justify-content-between align-items-center mb-2">
          <span>{{ user.username }}</span>
          <form method="POST" action="{{ url_for('send_friend_request', friend_id=user.id) }}">
            <button type="submit" class="btn btn-sm btn-outline-primary">Ajouter</button>
          </form>
        </div>
        {% endfor %}
      </div>
      {% else %}
      <div class="alert alert-info mt-3">Aucun utilisateur trouvé avec l'username "{{ search_email }}".</div>
      {% endif %}
      {% endif %}
    </div>
  </div>


  <!-- Demandes en attente -->
  {% if pending_requests %}
  <div class="card mb-4">
    <div class="card-header bg-warning text-dark">
      <h5>Demandes en attente</h5>
    </div>
    <div class="card-body">
      {% for friendship in pending_requests %}
      <div class="d-flex justify-content-between align-items-center mb-2">
        <span>{{ friendship.user.username }}</span>
        <div>
          <form class="d-inline" method="POST" action="{{ url_for('accept_friend_request', request_id=friendship.id) }}">
            <button type="submit" class="btn btn-sm btn-success">Accepter</button>
          </form>
          <form class="d-inline" method="POST" action="{{ url_for('reject_friend_request', request_id=friendship.id) }}">
            <button type="submit" class="btn btn-sm btn-danger">Refuser</button>
          </form>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
  {% endif %}

  <!-- Liste des amis -->
  <!-- Liste des amis -->
  <div class="card">
    <div class="card-header bg-success text-white">
      <h5>Mes Amis</h5>
    </div>
    <div class="card-body">
      {% if accepted_friends %}
      {% for friendship in accepted_friends %}
      {% if friendship.user_id == user.id %}
      {% set friend_user = friendship.friend %}
      {% else %}
      {% set friend_user = friendship.user %}
      {% endif %}
      <div class="d-flex justify-content-between align-items-center mb-2">
        <span>{{ friend_user.username }}</span>
        <span><a href="http://127.0.0.1:5000/friend_agenda/{{friend_user.id}}">Agenda</a></span>
        <form method="POST" action="{{ url_for('remove_friend', friendship_id=friendship.id) }}">
          <button type="submit" class="btn btn-sm btn-outline-danger">Supprimer</button>
        </form>
      </div>
      {% endfor %}
      {% else %}
      <div class="alert alert-info">Tu n'as pas encore d'amis.</div>
      {% endif %}
    </div>
  </div>

</div>
{% endblock %}
